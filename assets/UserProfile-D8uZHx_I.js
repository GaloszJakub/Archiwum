import{c as I,q as T,b as q,a as m,j as e,B as y,m as S,U as C,aB as g,r as f,l as p,n as d,aC as j,a4 as P,C as N,H as b}from"./index-BhxVA3-h.js";import{t as h}from"./tmdb-asYHfBOd.js";import{M as R}from"./MovieCard-CmO26ro0.js";import{f as $,p as D,r as z}from"./pl-bWXAYS08.js";import{A as v}from"./arrow-left-DJHjOC9v.js";import{S as F}from"./star-BJKxvO2E.js";import"./AddToCollectionButton-06Z1SQEP.js";import"./label-DGF_Vr0p.js";import"./useCollections-BhXn_aN5.js";import"./plus-C5ZNicyd.js";const M=I("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),U=({review:a})=>{const[i,n]=f.useState("");return f.useEffect(()=>{(async()=>{try{if(a.type==="movie"){const r=await h.getMovieDetails(a.tmdbId);n(r.title);const l=p(d,"reviews",a.id);await j(l,{mediaTitle:r.title})}else{const r=await h.getTVShowDetails(a.tmdbId);n(r.name||"");const l=p(d,"reviews",a.id);await j(l,{mediaTitle:r.name})}}catch{n(`${a.type==="movie"?"Film":"Serial"} #${a.tmdbId}`)}})()},[a]),i?e.jsx("span",{className:"text-sm text-primary font-medium",children:i}):null},O=()=>{const{userId:a}=T(),i=q(),{data:n,isLoading:u}=m({queryKey:["user-profile",a],queryFn:async()=>{const s=await P(p(d,"users",a));if(!s.exists())throw new Error("User not found");return s.data()},enabled:!!a}),{data:r,isLoading:l}=m({queryKey:["user-collections",a],queryFn:async()=>{const s=N(d,"users",a,"collections");return(await b(s)).docs.map(o=>({id:o.id,...o.data()}))},enabled:!!a,staleTime:300*1e3}),{data:x}=m({queryKey:["all-collection-items",a,r?.map(s=>s.id)],queryFn:async()=>{if(!r||r.length===0)return{};const s={};return await Promise.all(r.map(async t=>{const o=N(d,"users",a,"collections",t.id,"items"),w=await b(o);s[t.id]=w.docs.slice(0,6).map(k=>k.data())})),s},enabled:!!a&&!!r&&r.length>0,staleTime:300*1e3}),{data:c}=m({queryKey:["user-reviews",a],queryFn:()=>z.getUserReviews(a),enabled:!!a,staleTime:300*1e3});return u?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):n?e.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-8",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(y,{variant:"ghost",onClick:()=>i(-1),children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"Powrót"]})}),e.jsxs("div",{className:"bg-background-secondary rounded-xl p-8 flex items-center gap-6",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-primary/20 flex items-center justify-center",children:e.jsx(C,{className:"w-12 h-12 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:n.displayName}),e.jsx("p",{className:"text-foreground-secondary",children:n.email})]})]}),c&&c.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{className:"w-6 h-6 text-primary"}),e.jsx("h2",{className:"text-3xl font-bold",children:"Recenzje"}),e.jsxs("span",{className:"text-foreground-secondary",children:["(",c.length,")"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.map(s=>(s.mediaTitle,e.jsxs("div",{className:"bg-background-secondary rounded-xl p-6 space-y-3 cursor-pointer hover:bg-secondary/50 transition-colors",onClick:()=>i(s.type==="movie"?`/movie/${s.tmdbId}`:`/series/${s.tmdbId}`),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(t=>e.jsx(F,{className:`w-5 h-5 ${t<=s.rating?"fill-yellow-400 text-yellow-400":"text-gray-400"}`},t)),e.jsx("span",{className:"text-xs text-foreground-secondary ml-2",children:$(s.createdAt,{addSuffix:!0,locale:D})})]}),s.review&&e.jsx("p",{className:"text-foreground-secondary line-clamp-3",children:s.review}),s.mediaTitle?e.jsx("p",{className:"text-sm text-primary font-medium",children:s.mediaTitle}):e.jsx(U,{review:s})]},s.id)))})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"w-6 h-6 text-primary"}),e.jsx("h2",{className:"text-3xl font-bold",children:"Kolekcje"}),e.jsxs("span",{className:"text-foreground-secondary",children:["(",r?.length||0,")"]})]}),r&&r.length>0?e.jsx("div",{className:"space-y-6",children:r.map(s=>e.jsxs("div",{className:"bg-background-secondary rounded-xl p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-2xl font-bold mb-1",children:s.name}),s.description&&e.jsx("p",{className:"text-foreground-secondary",children:s.description}),e.jsxs("p",{className:"text-sm text-foreground-secondary mt-2",children:[s.itemCount," ",s.itemCount===1?"element":"elementów"]})]}),x?.[s.id]&&x[s.id].length>0&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:x[s.id].map(t=>e.jsx("div",{onClick:()=>i(t.type==="movie"?`/movie/${t.tmdbId}`:`/series/${t.tmdbId}`),children:e.jsx(R,{id:t.tmdbId.toString(),title:t.title,posterUrl:t.posterPath?h.getImageUrl(t.posterPath,"w500"):"https://via.placeholder.com/500x750?text=No+Image",tmdbId:t.tmdbId,type:t.type,posterPath:t.posterPath})},`${t.tmdbId}-${t.type}`))})]},s.id))}):e.jsxs("div",{className:"text-center py-12 bg-background-secondary rounded-xl",children:[e.jsx(g,{className:"w-16 h-16 text-foreground-secondary mx-auto mb-4"}),e.jsx("p",{className:"text-foreground-secondary",children:"Ten użytkownik nie ma jeszcze kolekcji"})]})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen gap-4",children:[e.jsx("p",{className:"text-foreground-secondary",children:"Nie znaleziono użytkownika"}),e.jsxs(y,{onClick:()=>i(-1),children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"Powrót"]})]})};export{O as default};
