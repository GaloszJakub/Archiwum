import{r as t,b as ae,j as s,B as f,S as re,I as ie,m as j,L as P}from"./index-Do5FezME.js";import{S as oe}from"./SplitText-BLJnEZkp.js";import{M as ne}from"./MovieCard-Dpm8xQvi.js";import{c as le,d as ce,e as o,u as de,f as pe,g as ge}from"./useTMDB-B4-GA8KA.js";import{t as ue}from"./tmdb-asYHfBOd.js";import{S as me,M as i}from"./MediaSection-CVWu1QML.js";import"./AddToCollectionButton-CWatftT8.js";import"./label-qC8oY3ar.js";import"./useCollections-puYkBbMI.js";import"./plus-pGei4JVk.js";const Me=()=>{const[d,b]=t.useState(""),[a,z]=t.useState(""),[p,N]=t.useState(!1),[n,g]=t.useState(""),[l,L]=t.useState(""),[u,_]=t.useState("popularity.desc"),w=t.useRef(null),D=ae(),{data:S}=le(),M=n||l||u!=="popularity.desc",m=a||M,{data:F,isLoading:C,error:I,fetchNextPage:E,hasNextPage:G,isFetchingNextPage:R}=ce(a),{data:T,isLoading:A,error:B,fetchNextPage:$,hasNextPage:Q,isFetchingNextPage:U}=o({with_genres:n,sort_by:u,year:l?parseInt(l):void 0}),{data:Y,isLoading:W}=de(),{data:H,isLoading:K}=pe(),{data:O,isLoading:Z}=ge(),{data:q}=o({with_genres:"28"}),{data:J}=o({with_genres:"35"}),{data:V}=o({with_genres:"27"}),{data:X}=o({with_genres:"18"}),{data:ee}=o({with_genres:"878"}),h=a?F?.pages.flatMap(e=>e.results)||[]:T?.pages.flatMap(e=>e.results)||[],c=a?C:A,x=a?I:B,k=a?E:$,v=a?G:Q,y=a?R:U;t.useEffect(()=>{const e=setTimeout(()=>{z(d)},500);return()=>clearTimeout(e)},[d]),t.useEffect(()=>{if(!m)return;const e=new IntersectionObserver(te=>{te[0].isIntersecting&&v&&!y&&k()},{threshold:.1}),r=w.current;return r&&e.observe(r),()=>{r&&e.unobserve(r)}},[m,v,y,k]);const se=e=>{g(e),b(""),p||N(!0)};return s.jsxs("div",{className:"space-y-8 pb-20",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(oe,{text:"Filmy",className:"text-3xl lg:text-5xl font-bold"}),s.jsx(f,{variant:"outline",size:"icon",onClick:()=>N(!p),className:`bg-background-secondary border-border hover:bg-secondary shrink-0 ${M?"text-primary border-primary":""}`,children:s.jsx(me,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"relative w-full",children:[s.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-foreground-secondary"}),s.jsx(ie,{type:"text",placeholder:"Szukaj filmów...",value:d,onChange:e=>b(e.target.value),className:"pl-10 bg-background-secondary border-border w-full"})]}),s.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:[s.jsx(f,{variant:n===""?"default":"outline",size:"sm",onClick:()=>g(""),className:"shrink-0",children:"Wszystkie"}),S?.genres.map(e=>s.jsx(f,{variant:n===e.id.toString()?"default":"outline",size:"sm",onClick:()=>se(e.id.toString()),className:"shrink-0",children:e.name},e.id))]})]}),p&&s.jsx(j.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-background-secondary rounded-lg p-4 border border-border",children:s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-foreground-secondary mb-2 block",children:"Gatunek"}),s.jsxs("select",{className:"w-full bg-background border border-border rounded-md px-3 py-2 text-sm text-foreground",value:n,onChange:e=>g(e.target.value),children:[s.jsx("option",{value:"",children:"Wszystkie"}),S?.genres.map(e=>s.jsx("option",{value:e.id.toString(),children:e.name},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-foreground-secondary mb-2 block",children:"Rok"}),s.jsxs("select",{className:"w-full bg-background border border-border rounded-md px-3 py-2 text-sm text-foreground",value:l,onChange:e=>L(e.target.value),children:[s.jsx("option",{value:"",children:"Wszystkie"}),Array.from({length:30},(e,r)=>new Date().getFullYear()-r).map(e=>s.jsx("option",{value:e.toString(),children:e},e))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-foreground-secondary mb-2 block",children:"Sortowanie"}),s.jsxs("select",{className:"w-full bg-background border border-border rounded-md px-3 py-2 text-sm text-foreground",value:u,onChange:e=>_(e.target.value),children:[s.jsx("option",{value:"popularity.desc",children:"Najpopularniejsze"}),s.jsx("option",{value:"vote_average.desc",children:"Najlepiej oceniane"}),s.jsx("option",{value:"release_date.desc",children:"Najnowsze"}),s.jsx("option",{value:"title.asc",children:"Alfabetycznie A-Z"})]})]})]})}),m?s.jsxs(s.Fragment,{children:[c&&s.jsx("div",{className:"flex items-center justify-center py-16",children:s.jsx(P,{className:"w-8 h-8 animate-spin text-primary"})}),x&&s.jsx("div",{className:"text-center py-16",children:s.jsx("p",{className:"text-foreground-secondary mb-4",children:"Błąd podczas ładowania filmów."})}),!c&&!x&&h.length>0&&s.jsx(j.div,{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},children:Array.from(new Map(h.map(e=>[e.id,e])).values()).map((e,r)=>s.jsx(j.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},onClick:()=>D(`/movie/${e.id}`),children:s.jsx(ne,{id:e.id.toString(),title:e.title||"Unknown",posterUrl:ue.getImageUrl(e.poster_path),year:e.release_date?new Date(e.release_date).getFullYear():void 0,rating:e.vote_average,layoutId:`movie-${e.id}`,tmdbId:e.id,type:"movie",posterPath:e.poster_path})},`${e.id}-${r}`))}),!c&&!x&&h.length===0&&s.jsx("div",{className:"text-center py-16",children:s.jsx("p",{className:"text-foreground-secondary",children:"Nie znaleziono filmów dla podanych kryteriów."})}),v&&!c&&s.jsx("div",{ref:w,className:"flex justify-center py-8",children:y&&s.jsx(P,{className:"w-6 h-6 animate-spin text-primary"})})]}):s.jsxs("div",{className:"space-y-12",children:[s.jsx(i,{title:"Popularne teraz",items:Y?.pages.flatMap(e=>e.results)||[],type:"movie",isLoading:W}),s.jsx(i,{title:"Nadchodzące premiery",items:H?.pages.flatMap(e=>e.results)||[],type:"movie",isLoading:K}),s.jsx(i,{title:"Najlepiej oceniane",items:O?.pages.flatMap(e=>e.results)||[],type:"movie",isLoading:Z}),s.jsx(i,{title:"Kino Akcji",items:q?.pages.flatMap(e=>e.results)||[],type:"movie"}),s.jsx(i,{title:"Komedie",items:J?.pages.flatMap(e=>e.results)||[],type:"movie"}),s.jsx(i,{title:"Horrory",items:V?.pages.flatMap(e=>e.results)||[],type:"movie"}),s.jsx(i,{title:"Dramaty",items:X?.pages.flatMap(e=>e.results)||[],type:"movie"}),s.jsx(i,{title:"Sci-Fi",items:ee?.pages.flatMap(e=>e.results)||[],type:"movie"})]})]})};export{Me as default};
