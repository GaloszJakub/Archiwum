class h{requests=[];maxRequests;timeWindow;constructor(t=100,e=6e4){this.maxRequests=t,this.timeWindow=e}canMakeRequest(){const t=Date.now();return this.requests=this.requests.filter(e=>t-e<this.timeWindow),!(this.requests.length>=this.maxRequests)}recordRequest(){this.requests.push(Date.now())}getRemainingRequests(){const t=Date.now();return this.requests=this.requests.filter(e=>t-e<this.timeWindow),Math.max(0,this.maxRequests-this.requests.length)}getTimeUntilReset(){if(this.requests.length===0)return 0;const e=Math.min(...this.requests)+this.timeWindow;return Math.max(0,e-Date.now())}}const i=new h(35,1e4),g="https://api.themoviedb.org/3",u="https://image.tmdb.org/t/p/w500";class m{apiKey;baseUrl;imageBaseUrl;constructor(){this.apiKey="",this.baseUrl=g,this.imageBaseUrl=u}async fetch(t,e={}){if(!i.canMakeRequest()){const a=Math.ceil(i.getTimeUntilReset()/1e3);throw new Error(`Rate limit exceeded. Please wait ${a} seconds.`)}const s=new URL(`${this.baseUrl}${t}`);s.searchParams.append("api_key",this.apiKey),s.searchParams.append("language","pl-PL"),Object.entries(e).forEach(([a,c])=>{s.searchParams.append(a,c)}),i.recordRequest();const r=await fetch(s.toString());if(!r.ok)throw new Error(`TMDB API error: ${r.statusText}`);return await r.json()}getImageUrl(t,e="w500"){return t?`https://image.tmdb.org/t/p/${e}${t}`:"https://images.unsplash.com/photo-1536440136628-849c177e76a1?w=400&h=600&fit=crop"}async searchMovies(t,e=1){return this.fetch("/search/movie",{query:t,page:e.toString()})}async searchTVShows(t,e=1){return this.fetch("/search/tv",{query:t,page:e.toString()})}async searchMulti(t,e=1){return this.fetch("/search/multi",{query:t,page:e.toString()})}async getMovieDetails(t){return this.fetch(`/movie/${t}`)}async getTVShowDetails(t){return this.fetch(`/tv/${t}`)}async getSeasonDetails(t,e){return this.fetch(`/tv/${t}/season/${e}`)}async getPopularMovies(t=1){const e=`tmdb_popular_movies_${t}`,s=this.getFromCache(e);if(s)return s;const r=await this.fetch("/movie/popular",{page:t.toString()});return this.saveToCache(e,r,3600*1e3),r}async getPopularTVShows(t=1){const e=`tmdb_popular_tv_${t}`,s=this.getFromCache(e);if(s)return s;const r=await this.fetch("/tv/popular",{page:t.toString()});return this.saveToCache(e,r,3600*1e3),r}async getUpcomingMovies(t=1){const e=`tmdb_upcoming_movies_${t}`,s=this.getFromCache(e);if(s)return s;const r=await this.fetch("/movie/upcoming",{page:t.toString(),region:"PL"});return this.saveToCache(e,r,3600*1e3),r}async getTopRatedMovies(t=1){const e=`tmdb_top_rated_movies_${t}`,s=this.getFromCache(e);if(s)return s;const r=await this.fetch("/movie/top_rated",{page:t.toString()});return this.saveToCache(e,r,3600*1e3),r}async getOnTheAirTVShows(t=1){const e=`tmdb_ontheair_tv_${t}`,s=this.getFromCache(e);if(s)return s;const r=await this.fetch("/tv/on_the_air",{page:t.toString()});return this.saveToCache(e,r,3600*1e3),r}async getTopRatedTVShows(t=1){const e=`tmdb_top_rated_tv_${t}`,s=this.getFromCache(e);if(s)return s;const r=await this.fetch("/tv/top_rated",{page:t.toString()});return this.saveToCache(e,r,3600*1e3),r}async getTrendingMovies(t="week"){const e=`tmdb_trending_movies_${t}`,s=this.getFromCache(e);if(s)return s;const r=await this.fetch(`/trending/movie/${t}`);return this.saveToCache(e,r,3600*1e3),r}async getTrendingTVShows(t="week"){const e=`tmdb_trending_tv_${t}`,s=this.getFromCache(e);if(s)return s;const r=await this.fetch(`/trending/tv/${t}`);return this.saveToCache(e,r,3600*1e3),r}async discoverMovies(t){const e={page:(t.page||1).toString()};return t.with_genres&&(e.with_genres=t.with_genres),t.sort_by&&(e.sort_by=t.sort_by),t.year&&(e.primary_release_year=t.year.toString()),this.fetch("/discover/movie",e)}async discoverTVShows(t){const e={page:(t.page||1).toString()};return t.with_genres&&(e.with_genres=t.with_genres),t.sort_by&&(e.sort_by=t.sort_by),t.year&&(e.first_air_date_year=t.year.toString()),this.fetch("/discover/tv",e)}async getMovieGenres(){return this.fetch("/genre/movie/list")}async getTVGenres(){return this.fetch("/genre/tv/list")}getFromCache(t){try{const e=localStorage.getItem(t);if(!e)return null;const{data:s,timestamp:r}=JSON.parse(e);return Date.now()-r<3600*1e3?s:(localStorage.removeItem(t),null)}catch{return null}}saveToCache(t,e,s){try{localStorage.setItem(t,JSON.stringify({data:e,timestamp:Date.now()}))}catch{}}}const d=new m;export{d as t};
