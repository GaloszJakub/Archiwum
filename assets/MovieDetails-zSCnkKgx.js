import{u as J,r as t,j as e,D as P,d as me,B as x,e as _,f as xe,g as he,h as pe,I as ge,i as M,k as j,l as je,s as ve,n as fe,o as ye,p as B,b as Y,q as be,m as ke}from"./index-Do5FezME.js";import{m as Ne}from"./useTMDB-B4-GA8KA.js";import{L as w}from"./label-qC8oY3ar.js";import{u as we,a as De,b as Ae,c as Ce,P as F,A as O,d as T,e as I,f as U,g as $,h as q,i as E,j as R,S as Se,C as ze,k as Le,R as Pe}from"./ScraperButton-OVTpODP3.js";import{S as G,a as H,b as W,c as V,d}from"./select-CiDdtluD.js";import{P as _e}from"./plus-pGei4JVk.js";import{t as Me}from"./tmdb-asYHfBOd.js";import{A as K}from"./arrow-left-BH0XIAJO.js";import{A as Be}from"./AddToCollectionButton-CWatftT8.js";import{S as Fe}from"./star-PWIeYpDw.js";import"./pl-lAGqhVVr.js";import"./pen-CPGXu6R4.js";import"./useCollections-puYkBbMI.js";const Oe=({tmdbId:s,movieTitle:n})=>{const{isAdmin:i}=J(),[o,p]=t.useState(!1),[u,h]=t.useState(""),[v,Q]=t.useState("1080p"),[f,Z]=t.useState("PL"),[g,D]=t.useState(!1),[X,ee]=t.useState(""),[se,y]=t.useState(!1),[A,C]=t.useState(null),[le,b]=t.useState(!1),[S,z]=t.useState(null),{data:m,isLoading:ie}=we(s),L=De(),k=Ae();Ce(g),t.useEffect(()=>{if(o||g){ye();const l=window.innerWidth-document.documentElement.clientWidth;document.body.style.overflow="hidden",document.body.style.paddingRight=`${l}px`}else B(),document.body.style.overflow="",document.body.style.paddingRight="";return()=>{B(),document.body.style.overflow="",document.body.style.paddingRight=""}},[o,g]);const ne=(l,r)=>{r.preventDefault(),ee(l),D(!0)},re=async()=>{if(u.trim())try{await L.mutateAsync({tmdbId:s,link:u.trim(),options:{title:n,quality:v,language:f}}),h(""),p(!1),j.success("Link dodany",{description:`${v} - ${f}`})}catch{j.error("Błąd podczas dodawania linku",{description:"Spróbuj ponownie"})}},te=l=>{z(l),b(!0)},ae=async()=>{if(!S)return;b(!1);const l=S;z(null),j.promise(k.mutateAsync({tmdbId:s,linkId:l}),{loading:"Usuwanie wszystkich linków...",success:"Wszystkie linki usunięte",error:"Błąd podczas usuwania"})},oe=(l,r)=>{C({linkId:l,linkIndex:r}),y(!0)},ce=async()=>{if(!A)return;const{linkId:l,linkIndex:r}=A,c=m?.find(a=>a.id===l);!c||!c.links||(y(!1),C(null),j.promise((async()=>{const a=c.links.filter(($e,ue)=>ue!==r);if(a.length===0){await k.mutateAsync({tmdbId:s,linkId:l});return}const de=je(fe,"episodes",l),N=a[0];await ve(de,{...c,link:N.url,quality:N.quality||"720p",language:N.version||"PL",links:a,updatedAt:new Date},{merge:!0}),await k.mutateAsync({tmdbId:s,linkId:l})})(),{loading:"Usuwanie linku...",success:"Link usunięty",error:"Błąd podczas usuwania linku"}))};return!i&&(!m||m.length===0)?null:e.jsxs("div",{className:"bg-background-secondary rounded-xl p-6 lg:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Zarządzanie linkami"}),i&&e.jsxs(P,{open:o,onOpenChange:p,modal:!0,children:[e.jsx(me,{asChild:!0,children:e.jsxs(x,{size:"sm",variant:"outline",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Dodaj link"]})}),e.jsxs(_,{className:"max-h-[90vh] overflow-y-auto",children:[e.jsxs(xe,{children:[e.jsx(he,{children:"Dodaj link"}),e.jsx(pe,{children:n})]}),e.jsxs("div",{className:"space-y-4 overflow-visible",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"link",children:"Link do filmu"}),e.jsx(ge,{id:"link",value:u,onChange:l=>h(l.target.value),placeholder:"https://...",type:"url"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"quality",children:"Jakość"}),e.jsxs(G,{value:v,onValueChange:Q,children:[e.jsx(H,{id:"quality",children:e.jsx(W,{})}),e.jsxs(V,{children:[e.jsx(d,{value:"2160p",children:"4K (2160p)"}),e.jsx(d,{value:"1080p",children:"Full HD (1080p)"}),e.jsx(d,{value:"720p",children:"HD (720p)"}),e.jsx(d,{value:"480p",children:"SD (480p)"})]})]})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"language",children:"Język"}),e.jsxs(G,{value:f,onValueChange:Z,children:[e.jsx(H,{id:"language",children:e.jsx(W,{})}),e.jsxs(V,{children:[e.jsx(d,{value:"PL",children:"Polski"}),e.jsx(d,{value:"ENG",children:"Angielski"}),e.jsx(d,{value:"PL/ENG",children:"PL/ENG"})]})]})]})]}),e.jsx(x,{onClick:re,disabled:!u.trim()||L.isPending,className:"w-full",children:"Dodaj link"})]})]})]})]}),ie?e.jsx("div",{className:"text-center py-4 text-foreground-secondary",children:"Ładowanie..."}):m&&m.length>0?e.jsx("div",{className:"space-y-4",children:m.map(l=>e.jsxs("div",{className:"bg-background rounded-xl p-6 border-2 border-border hover:border-primary/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-4 border-b border-border",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:"Dostępne odtwarzacze"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.links&&l.links.length>0?`${l.links.length} ${l.links.length===1?"link":"linki"} streamingowe`:"Brak linków"})]}),i&&e.jsxs(x,{size:"sm",variant:"ghost",onClick:()=>te(l.id),className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Usuń wszystkie"]})]}),l.links&&l.links.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:l.links.map((r,c)=>e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-background-secondary hover:bg-primary/5 rounded-lg border border-border hover:border-primary/50 transition-all group/link",children:[e.jsxs("button",{onClick:a=>ne(r.url,a),className:"flex items-center gap-3 flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-primary/20 rounded-lg flex items-center justify-center group-hover/link:bg-primary/30 transition-colors",children:e.jsx(F,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold text-sm truncate",children:r.provider}),e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-2",children:[r.version&&e.jsx("span",{children:r.version}),r.quality&&e.jsxs(e.Fragment,{children:[r.version&&e.jsx("span",{children:"•"}),e.jsx("span",{className:"text-primary font-medium",children:r.quality})]})]})]})]}),i&&e.jsx(x,{size:"icon",variant:"ghost",onClick:a=>{a.stopPropagation(),oe(l.id,c)},className:"h-8 w-8 flex-shrink-0 transition-opacity text-destructive hover:bg-destructive/10",children:e.jsx(M,{className:"w-4 h-4"})})]},c))}):l.link?e.jsxs("a",{href:l.link,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-4 bg-background-secondary hover:bg-primary/5 rounded-lg border border-border hover:border-primary/50 transition-all",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-primary/20 rounded-lg flex items-center justify-center",children:e.jsx(F,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:"Odtwórz film"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[l.quality," • ",l.language]})]})]}):e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"Brak dostępnych linków"})]},l.id))}):e.jsxs("div",{className:"text-center py-8 text-foreground-secondary",children:[e.jsx("p",{children:"Brak linków"}),i&&e.jsx("p",{className:"text-sm mt-2",children:"Dodaj pierwszy link"})]}),e.jsx(P,{open:g,onOpenChange:D,children:e.jsx(_,{className:"max-w-7xl w-full h-[90vh] p-0",children:e.jsx("div",{className:"relative w-full h-full bg-black",children:e.jsx("iframe",{src:X,className:"w-full h-full",allowFullScreen:!0,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",title:"Video Player"})})})}),e.jsx(O,{open:se,onOpenChange:y,children:e.jsxs(T,{children:[e.jsxs(I,{children:[e.jsx(U,{children:"Usunąć link?"}),e.jsx($,{children:"Czy na pewno chcesz usunąć ten link? Ta operacja jest nieodwracalna."})]}),e.jsxs(q,{children:[e.jsx(E,{children:"Anuluj"}),e.jsx(R,{onClick:ce,children:"Usuń"})]})]})}),e.jsx(O,{open:le,onOpenChange:b,children:e.jsxs(T,{children:[e.jsxs(I,{children:[e.jsx(U,{children:"Usunąć wszystkie linki?"}),e.jsx($,{children:"Czy na pewno chcesz usunąć wszystkie linki tego filmu? Ta operacja jest nieodwracalna."})]}),e.jsxs(q,{children:[e.jsx(E,{children:"Anuluj"}),e.jsx(R,{onClick:ae,children:"Usuń wszystkie"})]})]})})]})},Te=({data:s})=>{const n=Y();return e.jsxs("div",{className:"relative h-[50vh] md:h-[60vh] -mx-6 lg:-mx-8 -mt-6 lg:-mt-8 mb-8 overflow-hidden",children:[e.jsx("div",{className:"absolute top-6 left-6 z-10",children:e.jsxs(x,{variant:"ghost",onClick:()=>n("/movies"),className:"gap-2 bg-black/50 hover:bg-black/70 backdrop-blur-sm",children:[e.jsx(K,{className:"w-4 h-4"}),"Powrót"]})}),e.jsx("img",{src:Me.getImageUrl(s.backdrop_path||s.poster_path,"original"),alt:s.title,className:"w-full h-full object-cover object-top"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background via-background/50 to-transparent"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 lg:p-8",children:e.jsxs("div",{className:"max-w-4xl",children:[e.jsx("h1",{className:"text-4xl md:text-6xl font-bold mb-4",children:s.title}),s.tagline&&e.jsx("p",{className:"text-xl text-foreground-secondary italic mb-6",children:s.tagline})]})})]})},Ie=({data:s})=>e.jsxs("div",{className:"flex flex-wrap items-center gap-6",children:[e.jsx(Be,{tmdbId:s.id,type:"movie",title:s.title,posterPath:s.poster_path}),e.jsx(Se,{movieId:`tmdb_${s.id}`,title:s.title,type:"movie",year:s.release_date?new Date(s.release_date).getFullYear():void 0}),s.vote_average>0&&e.jsxs("div",{className:"flex items-center gap-2 bg-primary/20 px-4 py-2 rounded-lg",children:[e.jsx(Fe,{className:"w-5 h-5 text-primary fill-current"}),e.jsx("span",{className:"text-2xl font-bold",children:s.vote_average.toFixed(1)}),e.jsx("span",{className:"text-foreground-secondary text-sm",children:"/ 10"})]}),s.release_date&&e.jsxs("div",{className:"flex items-center gap-2 text-foreground-secondary",children:[e.jsx(ze,{className:"w-5 h-5"}),e.jsx("span",{className:"text-lg",children:new Date(s.release_date).getFullYear()})]}),s.runtime&&e.jsxs("div",{className:"flex items-center gap-2 text-foreground-secondary",children:[e.jsx(Le,{className:"w-5 h-5"}),e.jsxs("span",{className:"text-lg",children:[s.runtime," min"]})]}),s.status&&e.jsx("div",{className:"px-4 py-2 bg-background-secondary rounded-lg text-lg",children:s.status})]}),Ue=({data:s})=>{const n=[];return s.popularity>0&&n.push({label:"Popularność",value:s.popularity.toFixed(0)}),s.vote_count>0&&n.push({label:"Głosy",value:s.vote_count.toLocaleString()}),s.budget&&s.budget>0&&n.push({label:"Budżet",value:`$${(s.budget/1e6).toFixed(0)}M`}),s.revenue&&s.revenue>0&&n.push({label:"Przychód",value:`$${(s.revenue/1e6).toFixed(0)}M`}),s.spoken_languages&&s.spoken_languages.length>0&&n.push({label:"Język",value:s.spoken_languages.map(i=>i.name).join(", ")}),s.production_companies&&s.production_companies.length>0&&n.push({label:"Produkcja",value:s.production_companies[0].name}),n.length===0?null:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map((i,o)=>e.jsxs("div",{className:"bg-background-secondary rounded-xl p-6",children:[e.jsx("h3",{className:"text-sm text-foreground-secondary mb-2",children:i.label}),e.jsx("p",{className:"text-2xl font-bold",children:i.value})]},o))})},es=()=>{const{id:s}=be(),n=Y(),{data:i,isLoading:o,error:p}=Ne(parseInt(s||"0")),{isAdmin:u}=J();return o?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):p||!i?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen gap-4",children:[e.jsx("p",{className:"text-foreground-secondary",children:"Brak wyników"}),e.jsxs(x,{onClick:()=>n("/movies"),children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Powrót"]})]}):e.jsxs(ke.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"min-h-screen",children:[e.jsx(Te,{data:i}),e.jsxs("div",{className:"max-w-6xl mx-auto space-y-8",children:[e.jsx(Ie,{data:i}),i.genres&&i.genres.length>0&&e.jsx("div",{className:"flex flex-wrap gap-3",children:i.genres.map(h=>e.jsx("span",{className:"px-4 py-2 bg-primary/10 text-primary rounded-full text-base font-medium",children:h.name},h.id))}),u&&e.jsx(Oe,{tmdbId:i.id,movieTitle:i.title}),e.jsxs("div",{className:"bg-background-secondary rounded-xl p-6 lg:p-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Opis"}),e.jsx("p",{className:"text-foreground-secondary text-lg leading-relaxed",children:i.overview||"Brak opisu"})]}),e.jsx(Ue,{data:i}),e.jsx(Pe,{tmdbId:i.id,type:"movie",mediaTitle:i.title})]})]})};export{es as default};
