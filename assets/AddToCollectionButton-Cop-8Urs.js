import{c as A,u as D,r as m,j as e,D as b,d as z,B as l,e as I,f as T,g as E,h as L,I as P,a9 as S}from"./index-DmLfijxt.js";import{L as C}from"./label-DCHFiqzZ.js";import{u as B,f as U,a as F,g as O}from"./useCollections-C9CdyNsj.js";import{P as w}from"./plus-B0qxDNQy.js";const W=A("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),R=({tmdbId:i,type:c,title:h,posterPath:u})=>{const{user:f}=D(),[k,x]=m.useState(!1),[n,o]=m.useState(""),[N,r]=m.useState(!1),{data:d,isLoading:p}=B(),{data:y}=U(i,c),j=F(),t=O(),g=async()=>{if(n.trim())try{const s=await j.mutateAsync({name:n.trim()});await t.mutateAsync({collectionId:s,item:{tmdbId:i,type:c,title:h,posterPath:u}}),o(""),r(!1),x(!1)}catch{}},v=async s=>{try{await t.mutateAsync({collectionId:s,item:{tmdbId:i,type:c,title:h,posterPath:u}})}catch(a){a.message}};return f?e.jsxs(b,{open:k,onOpenChange:x,children:[e.jsx(z,{asChild:!0,children:e.jsx(l,{variant:"outline",size:"icon",children:e.jsx(w,{className:"w-4 h-4"})})}),e.jsxs(I,{children:[e.jsxs(T,{children:[e.jsx(E,{children:"Dodaj do kolekcji"}),e.jsx(L,{children:"Wybierz kolekcję lub utwórz nową"})]}),e.jsx("div",{className:"space-y-4",children:p?e.jsx("div",{className:"text-center py-4",children:"Ładowanie..."}):e.jsxs(e.Fragment,{children:[d&&d.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Twoje kolekcje"}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:d.map(s=>{const a=y?.includes(s.id);return e.jsx("button",{onClick:()=>!a&&v(s.id),className:`w-full text-left p-3 rounded-lg border transition-colors ${a?"bg-green-500/10 border-green-500/30":"hover:bg-accent"} ${t.isPending?"opacity-50 cursor-not-allowed":""}`,disabled:t.isPending,children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[s.name,a&&e.jsx(W,{className:"w-5 h-5 text-green-500 shrink-0"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.itemCount," ",s.itemCount===1?"element":"elementów"]})]})})},s.id)})})]}),N?e.jsxs("div",{className:"space-y-3",children:[e.jsx(C,{htmlFor:"collection-name",children:"Nazwa nowej kolekcji"}),e.jsx(P,{id:"collection-name",value:n,onChange:s=>o(s.target.value),placeholder:"Moja kolekcja",onKeyDown:s=>s.key==="Enter"&&g()}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{onClick:g,disabled:!n.trim()||j.isPending,className:"flex-1",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Utwórz i dodaj"]}),e.jsx(l,{variant:"outline",onClick:()=>{r(!1),o("")},children:"Anuluj"})]})]}):e.jsxs(l,{variant:"outline",onClick:()=>r(!0),className:"w-full",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Utwórz nową kolekcję"]})]})})]})]}):null};export{R as A};
